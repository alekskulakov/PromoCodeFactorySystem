# Новые требования

- Для нормальной работы с партнерами решили добавить в систему список партнеров и вести их активность, также будет сохраняться количество промокодов, которые выдал партнер.
- Приняли решение для части партнеров в ручном порядке продавать подписку на использование API. Для контроля подписки вводим лимиты на выдачу промокодов для партнеров, и при попытке выдать промокод будем контролировать лимиты.
- Лимиты будем задавать и отменять через API. Лимиты должны иметь дату создания, окончания и, если отменим до даты окончания, то дату отмены, а также количество промокодов в лимите.

# Описание

В домашнем задании нужно протестировать установку лимитов партнеру.  
Тесты можно писать в файле `SetPartnerPromoCodeLimitAsyncTests` в проекте `UnitTests`.  
Сделать форк репозитория и реализовать пункты в нем.

Нужно протестировать следующие Test Cases для установки партнеру (класс `Partner`) лимита (класс `PartnerLimit`) метод `SetPartnerPromoCodeLimitAsync` в `PartnersController`:

1. Если партнер не найден, то также нужно выдать ошибку 404.
2. Если партнер заблокирован, то есть поле `IsActive=false` в классе `Partner`, то также нужно выдать ошибку 400.
3. Если партнеру выставляется лимит, то мы должны обнулить количество промокодов, которые партнер выдал `NumberIssuedPromoCodes`, если лимит закончился, то количество не обнуляется.
4. При установке лимита нужно отключить предыдущий лимит.
5. Лимит должен быть больше 0.
6. Нужно убедиться, что сохранили новый лимит в базу данных (это нужно проверить Unit-тестом).
   

# Условия

Тесты должны соответствовать следующим условиям:

- Использовать именование: `ИмяЕдиницыТестирования_Условие_ОжидаемыйРезультат`.
- Для Arrange этапа должен использоваться фабричный метод при определении данных.
- Для Mock использовать `NSubstitute`.
- Для создания тестируемого класса, например, `PartnersController`, можно использовать `AutoFixture` или также использовать фабричный метод.
- Для проверки утверждения в тестах должен использоваться `FluentAssertions`.
- В качестве дополнительного условия тестовые данные должны формироваться с помощью Builder, если не будет использоваться `AutoFixture`, то `NSubstitute` также должны настраиваться через Builder.
- В качестве дополнительного условия можно провести рефакторинг `PartnersController` или только метода `SetPartnerPromoCodeLimitAsync` на свое усмотрение, можно ввести дополнительные классы для повышения удобства тестирования и сопровождения. Если появятся дополнительные классы и методы, то они тоже должны быть протестированы. Принцип расположения тестов в проекте — соответствующий тестам в примере (Например, `WebHost/Controllers/PartnersControllerTests`).
- Если будет сделан рефакторинг, то при сдаче ДЗ поясните, какие классы были введены.
